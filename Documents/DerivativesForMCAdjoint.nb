(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     43585,       1240]
NotebookOptionsPosition[     40193,       1155]
NotebookOutlinePosition[     40550,       1171]
CellTagsIndexPosition[     40507,       1168]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"f", "[", "sw_", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"sw", "^", "2"}], "/", "phi"}], "/", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"sw", "^", "2"}], " ", "+", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "sw"}], ")"}], "^", "2"}], "*", 
      RowBox[{"muw", "/", "muo"}]}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.732869240794199*^9, 3.73286924555905*^9}, {
   3.732869319582374*^9, 3.732869345550112*^9}, {3.732869397365831*^9, 
   3.732869420158765*^9}, 
   3.732869835331029*^9},ExpressionUUID->"3c61f35a-b755-45f5-b649-\
45adc1aa30f5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"f", "[", "sw", "]"}], ",", " ", "sw"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.732869349021751*^9, 
  3.7328693662156267`*^9}},ExpressionUUID->"030cd932-4fb1-4400-99a9-\
4a5f9858f8c6"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{"2", " ", "muo", " ", "muw", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"-", "1"}], "+", "sw"}], ")"}], " ", "sw"}], 
   RowBox[{"phi", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"muw", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "1"}], "+", "sw"}], ")"}], "2"]}], "+", 
       RowBox[{"muo", " ", 
        SuperscriptBox["sw", "2"]}]}], ")"}], "2"]}]]}]], "Output",
 CellChangeTimes->{{3.732869355519813*^9, 3.732869367012561*^9}, 
   3.732869423552795*^9},ExpressionUUID->"23a632f2-7605-41b2-85b2-\
a95311b3c85b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"hmean", "[", 
   RowBox[{"a_", ",", " ", "b_"}], "]"}], " ", ":=", " ", 
  RowBox[{"2", "*", "a", "*", 
   RowBox[{"b", "/", 
    RowBox[{"(", 
     RowBox[{"a", "+", "b"}], ")"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7328697856441393`*^9, 
  3.732869801659514*^9}},ExpressionUUID->"a9ffe9a4-b898-46e0-8b69-\
be25933f186e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"hmean", "[", 
     RowBox[{"a", ",", " ", "b"}], "]"}], ",", " ", "b"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.733028617053545*^9, 
  3.733028645988908*^9}},ExpressionUUID->"085d25eb-7878-42af-9b6c-\
39151efe675f"],

Cell[BoxData[
 FractionBox[
  RowBox[{"2", " ", 
   SuperscriptBox["a", "2"]}], 
  SuperscriptBox[
   RowBox[{"(", 
    RowBox[{"a", "+", "b"}], ")"}], "2"]]], "Output",
 CellChangeTimes->{
  3.7330286468073874`*^9},ExpressionUUID->"2bebc656-e850-4002-bfea-\
16e5bf19fe3f"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"lambda", "[", 
   RowBox[{"sw_", ",", " ", "lnk_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Exp", "[", "lnk", "]"}], " ", "*", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "sw"}], ")"}], "^", "2"}], "/", "muo"}], " ", "+", 
     " ", 
     RowBox[{
      RowBox[{"sw", "^", "2"}], "/", "muw"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.7328698281218243`*^9, 3.732869883872843*^9}, {
   3.732870167667646*^9, 3.732870172657856*^9}, 3.7328712160267773`*^9, {
   3.733028170290901*^9, 3.733028185297578*^9}, {3.7330283509339743`*^9, 
   3.733028356700862*^9}, {3.73302849411451*^9, 3.733028495264436*^9}, {
   3.734765008443531*^9, 
   3.73476501949752*^9}},ExpressionUUID->"78b3c9dd-837e-49d7-9034-\
51a0dc085d7a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"T", "[", 
   RowBox[{"swa_", ",", " ", "swb_", ",", " ", "lnka_", ",", " ", "lnkb_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"hmean", "[", 
   RowBox[{
    RowBox[{"lambda", "[", 
     RowBox[{"swa", ",", " ", "lnka"}], "]"}], ",", " ", 
    RowBox[{"lambda", "[", 
     RowBox[{"swb", ",", " ", "lnkb"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.732869914553637*^9, 3.732869952311324*^9}, {
  3.733028192370133*^9, 
  3.733028222671603*^9}},ExpressionUUID->"9ef741a7-f0c8-40e0-81ea-\
d7d301fb57a2"],

Cell[BoxData[
 RowBox[{"pressureConstraint", " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"T", "[", 
     RowBox[{"swl", ",", " ", "swk", ",", " ", "lnkl", ",", " ", "lnkk"}], 
     "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "pl"}], ")"}]}], " ", "+", " ", 
   RowBox[{
    RowBox[{"T", "[", 
     RowBox[{"swr", ",", " ", "swk", ",", " ", "lnkr", ",", " ", "lnkk"}], 
     "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "pr"}], ")"}]}], " ", "+", " ", 
   RowBox[{
    RowBox[{"T", "[", 
     RowBox[{"swu", ",", " ", "swk", ",", " ", "lnku", ",", " ", "lnkk"}], 
     "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "pu"}], ")"}]}], " ", "+", " ", 
   RowBox[{
    RowBox[{"T", "[", 
     RowBox[{"swd", ",", " ", "swk", ",", " ", "lnkd", ",", " ", "lnkk"}], 
     "]"}], "*", 
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "pd"}], ")"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7328699908520193`*^9, 3.7328700954683123`*^9}, {
  3.733028229178958*^9, 3.73302828902313*^9}, {3.7330285630427027`*^9, 
  3.733028565680244*^9}},ExpressionUUID->"7b36a369-1dc9-4930-82a8-\
203f189d0b1c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FullSimplify", "[", 
   RowBox[{"D", "[", 
    RowBox[{"pressureConstraint", ",", " ", "lnkl"}], "]"}], "]"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.732870098388587*^9, 3.732870125089869*^9}, {
  3.732870184735718*^9, 3.7328702254403973`*^9}, {3.732870266466818*^9, 
  3.7328702741194887`*^9}, {3.733028294986184*^9, 3.733028295558766*^9}, {
  3.733029326951962*^9, 
  3.733029327709408*^9}},ExpressionUUID->"5313eccb-2a96-43ff-a55a-\
d47ee57f54a8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"pk", "-", "pl"}], ")"}], " ", 
  RowBox[{
   SuperscriptBox["lambda", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"0", ",", "1"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"swl", ",", "lnkl"}], "]"}], " ", 
  RowBox[{
   SuperscriptBox["hmean", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"1", ",", "0"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{
    RowBox[{"lambda", "[", 
     RowBox[{"swl", ",", "lnkl"}], "]"}], ",", 
    RowBox[{"lambda", "[", 
     RowBox[{"swk", ",", "lnkk"}], "]"}]}], "]"}]}]], "Output",
 CellChangeTimes->{
  3.7328701055578003`*^9, 3.732870187291789*^9, {3.732870226071805*^9, 
   3.7328702402380753`*^9}, 3.7328702805393972`*^9, 3.7330283712089863`*^9, 
   3.733028461325811*^9, 3.733028502107789*^9, 3.7330285688006277`*^9, {
   3.733029330588485*^9, 
   3.733029336733923*^9}},ExpressionUUID->"7206a949-0c6e-4a13-8a90-\
79941fd51940"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{
    RowBox[{"lambda", "[", 
     RowBox[{"sw", ",", " ", "lnk"}], "]"}], ",", " ", "sw"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.732871196232175*^9, 3.732871208490144*^9}, {
  3.734764998914119*^9, 
  3.734764999634674*^9}},ExpressionUUID->"e7661b80-fe98-4504-ba02-\
280b81537db0"],

Cell[BoxData[
 FractionBox[
  RowBox[{"2", " ", 
   SuperscriptBox["\[ExponentialE]", "lnk"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"muw", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", "sw"}], ")"}]}], "+", 
     RowBox[{"muo", " ", "sw"}]}], ")"}]}], 
  RowBox[{"muo", " ", "muw"}]]], "Output",
 CellChangeTimes->{{3.732871209082905*^9, 3.732871219610009*^9}, {
  3.7347650007308617`*^9, 
  3.73476502598556*^9}},ExpressionUUID->"df0d8a42-edfa-4bf4-a521-\
7703f71af728"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.732871560943013*^9, 3.732871565462512*^9}, {
  3.734784178386403*^9, 
  3.734784179957443*^9}},ExpressionUUID->"569b7360-5313-4bce-8abd-\
a107075adfd8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"pressureConstraint", ",", " ", "lnkk"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.732871547410276*^9, 3.7328715475119963`*^9}, {
  3.733031047481427*^9, 
  3.733031063654819*^9}},ExpressionUUID->"c0f42fc0-ba60-4828-b2d9-\
68407a26b221"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "pd"}], "+", "pk"}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["hmean", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{
       RowBox[{"lambda", "[", 
        RowBox[{"swd", ",", "lnkd"}], "]"}], ",", 
       RowBox[{"lambda", "[", 
        RowBox[{"swk", ",", "lnkk"}], "]"}]}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"pk", "-", "pl"}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["hmean", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{
       RowBox[{"lambda", "[", 
        RowBox[{"swl", ",", "lnkl"}], "]"}], ",", 
       RowBox[{"lambda", "[", 
        RowBox[{"swk", ",", "lnkk"}], "]"}]}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"pk", "-", "pr"}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["hmean", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{
       RowBox[{"lambda", "[", 
        RowBox[{"swr", ",", "lnkr"}], "]"}], ",", 
       RowBox[{"lambda", "[", 
        RowBox[{"swk", ",", "lnkk"}], "]"}]}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"pk", "-", "pu"}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["hmean", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{
       RowBox[{"lambda", "[", 
        RowBox[{"swu", ",", "lnku"}], "]"}], ",", 
       RowBox[{"lambda", "[", 
        RowBox[{"swk", ",", "lnkk"}], "]"}]}], "]"}]}]}], ")"}], " ", 
  RowBox[{
   SuperscriptBox["lambda", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"0", ",", "1"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"swk", ",", "lnkk"}], "]"}]}]], "Output",
 CellChangeTimes->{{3.732871549237563*^9, 3.7328715678276367`*^9}, {
  3.733031048474455*^9, 
  3.73303106465093*^9}},ExpressionUUID->"8356122b-e9e0-4a1d-8aca-\
36a730b56540"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"pressureConstraint", ",", " ", "lnk"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.733028086507368*^9, 
  3.733028087980966*^9}},ExpressionUUID->"e3ec01e8-cc2c-4e7e-b151-\
dfa58a69bf2b"],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{
  3.7330280986793823`*^9},ExpressionUUID->"b8c416b7-19c5-4391-a9eb-\
9da48156b03a"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"lambdaAlt", "[", "lnk_", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Exp", "[", "lnk", "]"}], " ", "*", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", ")"}], "^", "2"}], "/", "muo"}], " ", "+", " ", 
     RowBox[{
      RowBox[{"sw", "^", "2"}], "/", "muw"}]}], ")"}], " "}]}]], "Input",
 CellChangeTimes->{{3.7330281059256363`*^9, 3.73302813021164*^9}, 
   3.733028162467969*^9},ExpressionUUID->"5e066f53-a4d9-42f5-b5e7-\
510e74721938"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.733028141964054*^9, 3.733028145102707*^9}, 
   3.733042583634119*^9},ExpressionUUID->"44734e29-1c6d-4b7b-af80-\
d5bcdeb1e8ed"],

Cell[BoxData[
 RowBox[{"saturationConstraint", " ", ":=", " ", 
  RowBox[{"sknow", " ", "-", " ", "skbefore", "  ", "+", " ", 
   RowBox[{
    RowBox[{"timestep", " ", "/", " ", "h"}], " ", "*", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"upwindF", "[", 
        RowBox[{"skbefore", ",", "sebefore", ",", " ", "vxe"}], "]"}], " ", 
       "*", " ", "vxe"}], " ", "-", "  ", 
      RowBox[{
       RowBox[{"upwindF", "[", 
        RowBox[{"skbefore", ",", "swbefore", ",", " ", "vxw"}], "]"}], " ", 
       "*", " ", "vxw"}], " ", "+", " ", 
      RowBox[{
       RowBox[{"upwindF", "[", 
        RowBox[{"skbefore", ",", "snbefore", ",", " ", "vyn"}], "]"}], " ", 
       "*", " ", "vyn"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"upwindF", "[", 
        RowBox[{"skbefore", ",", "ssbefore", ",", " ", "vys"}], "]"}], " ", 
       "*", " ", "vys"}]}], ")"}]}]}]}]], "Input",
 CellChangeTimes->{{3.73478418346548*^9, 3.734784215594255*^9}, {
  3.735286502626293*^9, 3.735286521609445*^9}, {3.735286558547183*^9, 
  3.735286749979723*^9}},ExpressionUUID->"1efb9c53-43db-4ac2-8c43-\
5bffdab9bb2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"upwindF", "[", 
   RowBox[{"sk_", ",", " ", "sn_", ",", " ", "v_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"HeavisideTheta", "[", "v", "]"}], " ", "*", " ", 
    RowBox[{"F", "[", "sk", "]"}]}], " ", "+", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", " ", "-", " ", 
      RowBox[{"HeavisideTheta", "[", "v", "]"}]}], ")"}], " ", "*", " ", 
    RowBox[{"F", "[", "sn", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.735286766081534*^9, 
  3.7352868983774347`*^9}},ExpressionUUID->"19732302-0ac5-4fb8-84d6-\
14647ff9bf4d"],

Cell[BoxData[
 RowBox[{"vxe", " ", ":=", " ", 
  RowBox[{
   RowBox[{"-", " ", 
    RowBox[{"hmean", "[", 
     RowBox[{
      RowBox[{"lambda", "[", 
       RowBox[{"skbefore", ",", " ", "lnk"}], "]"}], ",", " ", 
      RowBox[{"lambda", "[", 
       RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"pe", " ", "-", " ", "pk"}], ")"}], " ", "/", "h", 
    " "}]}]}]], "Input",
 CellChangeTimes->{{3.735286904874642*^9, 
  3.735287035756077*^9}},ExpressionUUID->"e3fe45a6-dba8-461a-9213-\
cb075bcb78fa"],

Cell[BoxData[
 RowBox[{"vxw", " ", ":=", " ", 
  RowBox[{
   RowBox[{"-", " ", 
    RowBox[{"hmean", "[", 
     RowBox[{
      RowBox[{"lambda", "[", 
       RowBox[{"skbefore", ",", " ", "lnk"}], "]"}], ",", " ", 
      RowBox[{"lambda", "[", 
       RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}], " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "pw"}], ")"}], " ", "/", "h", 
    " "}]}]}]], "Input",
 CellChangeTimes->{{3.7352870531155787`*^9, 
  3.735287079257946*^9}},ExpressionUUID->"41dec174-3c77-4a16-82f2-\
07b3b700cf02"],

Cell[BoxData[
 RowBox[{"vyn", " ", ":=", " ", 
  RowBox[{
   RowBox[{"-", " ", 
    RowBox[{"hmean", "[", 
     RowBox[{
      RowBox[{"lambda", "[", 
       RowBox[{"skbefore", ",", " ", "lnk"}], "]"}], ",", " ", 
      RowBox[{"lambda", "[", 
       RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"pn", " ", "-", " ", "pk"}], ")"}], " ", "/", "h", 
    " "}]}]}]], "Input",
 CellChangeTimes->{{3.7352870858616533`*^9, 
  3.7352871004994907`*^9}},ExpressionUUID->"62734858-5283-4908-99da-\
21fba927c924"],

Cell[BoxData[
 RowBox[{"vys", " ", ":=", " ", 
  RowBox[{
   RowBox[{"-", " ", 
    RowBox[{"hmean", "[", 
     RowBox[{
      RowBox[{"lambda", "[", 
       RowBox[{"skbefore", ",", " ", "lnk"}], "]"}], ",", " ", 
      RowBox[{"lambda", "[", 
       RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"pk", " ", "-", " ", "ps"}], ")"}], " ", "/", "h", 
    " "}]}]}]], "Input",
 CellChangeTimes->{{3.735287105946682*^9, 
  3.7352871242493277`*^9}},ExpressionUUID->"012e5d3a-b7c1-43c9-aa60-\
4318f883c3cc"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "lambda", ",", " ", "vxe", ",", " ", "vxw", ",", " ", "vyn", ",", " ", 
   "vys"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"vxe", " ", ":=", " ", 
  RowBox[{"vxef", "[", 
   RowBox[{
   "skbefore", ",", " ", "lnk", ",", " ", "sebefore", ",", " ", "lne", ",", 
    " ", "pe", ",", " ", "pk"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"vxw", " ", ":=", " ", 
  RowBox[{"vxwf", "[", 
   RowBox[{
   "skbefore", ",", " ", "lnk", ",", " ", "swbefore", ",", " ", "lnw", ",", 
    " ", "pw", ",", " ", "pk"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"vys", " ", ":=", " ", 
  RowBox[{"vysf", "[", 
   RowBox[{
   "skbefore", ",", " ", "lnk", ",", " ", "ssbefore", ",", " ", "lns", ",", 
    " ", "ps", ",", " ", "pk"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"vyn", " ", ":=", " ", 
  RowBox[{"vynf", "[", 
   RowBox[{
   "skbefore", ",", " ", "lnk", ",", " ", "snbefore", ",", " ", "lnn", ",", 
    " ", "pn", ",", " ", "pk"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.735287127065065*^9, 3.735287170683264*^9}, {
  3.73528730395228*^9, 3.73528732410544*^9}, {3.735287359416573*^9, 
  3.735287365818844*^9}, {3.735287426908443*^9, 
  3.735287511499434*^9}},ExpressionUUID->"19d88ea9-40b0-465c-ac9a-\
7a68bc5bfd2d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FullSimplify", "[", 
  RowBox[{"D", "[", 
   RowBox[{"saturationConstraint", ",", " ", "skbefore"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.735287174379361*^9, 
  3.735287188587487*^9}},ExpressionUUID->"95744756-87c2-4ca8-97a1-\
981b72d38e38"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "1"}], "+", 
  RowBox[{
   FractionBox["1", "h"], 
   RowBox[{"timestep", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["1", "h"], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"pe", "-", "pk"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"F", "[", "sebefore", "]"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"F", "[", "sebefore", "]"}], "-", 
                RowBox[{"F", "[", "skbefore", "]"}]}], ")"}], " ", 
              RowBox[{"HeavisideTheta", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", "pe"}], "+", "pk"}], ")"}], " ", 
                 RowBox[{"hmean", "[", 
                  RowBox[{
                   RowBox[{"lambda", "[", 
                    RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                   RowBox[{"lambda", "[", 
                    RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], "h"], 
               "]"}]}]}], ")"}], " ", 
           RowBox[{
            SuperscriptBox["hmean", 
             TagBox[
              RowBox[{"(", 
               RowBox[{"1", ",", "0"}], ")"}],
              Derivative],
             MultilineFunction->None], "[", 
            RowBox[{
             RowBox[{"lambda", "[", 
              RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
             RowBox[{"lambda", "[", 
              RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "pk"}], "+", "pn"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"F", "[", "snbefore", "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"F", "[", "skbefore", "]"}], "-", 
                RowBox[{"F", "[", "snbefore", "]"}]}], ")"}], " ", 
              RowBox[{"HeavisideTheta", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"pk", "-", "pn"}], ")"}], " ", 
                 RowBox[{"hmean", "[", 
                  RowBox[{
                   RowBox[{"lambda", "[", 
                    RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                   RowBox[{"lambda", "[", 
                    RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], "h"], 
               "]"}]}]}], ")"}], " ", 
           RowBox[{
            SuperscriptBox["hmean", 
             TagBox[
              RowBox[{"(", 
               RowBox[{"1", ",", "0"}], ")"}],
              Derivative],
             MultilineFunction->None], "[", 
            RowBox[{
             RowBox[{"lambda", "[", 
              RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
             RowBox[{"lambda", "[", 
              RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"pk", "-", "ps"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"F", "[", "ssbefore", "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"F", "[", "skbefore", "]"}], "-", 
                RowBox[{"F", "[", "ssbefore", "]"}]}], ")"}], " ", 
              RowBox[{"HeavisideTheta", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", "pk"}], "+", "ps"}], ")"}], " ", 
                 RowBox[{"hmean", "[", 
                  RowBox[{
                   RowBox[{"lambda", "[", 
                    RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                   RowBox[{"lambda", "[", 
                    RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], "h"], 
               "]"}]}]}], ")"}], " ", 
           RowBox[{
            SuperscriptBox["hmean", 
             TagBox[
              RowBox[{"(", 
               RowBox[{"1", ",", "0"}], ")"}],
              Derivative],
             MultilineFunction->None], "[", 
            RowBox[{
             RowBox[{"lambda", "[", 
              RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
             RowBox[{"lambda", "[", 
              RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"pk", "-", "pw"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"F", "[", "swbefore", "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"F", "[", "skbefore", "]"}], "-", 
                RowBox[{"F", "[", "swbefore", "]"}]}], ")"}], " ", 
              RowBox[{"HeavisideTheta", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", "pk"}], "+", "pw"}], ")"}], " ", 
                 RowBox[{"hmean", "[", 
                  RowBox[{
                   RowBox[{"lambda", "[", 
                    RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                   RowBox[{"lambda", "[", 
                    RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}], "h"], 
               "]"}]}]}], ")"}], " ", 
           RowBox[{
            SuperscriptBox["hmean", 
             TagBox[
              RowBox[{"(", 
               RowBox[{"1", ",", "0"}], ")"}],
              Derivative],
             MultilineFunction->None], "[", 
            RowBox[{
             RowBox[{"lambda", "[", 
              RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
             RowBox[{"lambda", "[", 
              RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}]}], ")"}], 
        " ", 
        RowBox[{
         SuperscriptBox["lambda", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}], "+", 
      RowBox[{
       FractionBox["1", "h"], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "pe"}], "+", "pk"}], ")"}], " ", 
        RowBox[{"hmean", "[", 
         RowBox[{
          RowBox[{"lambda", "[", 
           RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
          RowBox[{"lambda", "[", 
           RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"HeavisideTheta", "[", 
            FractionBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "pe"}], "+", "pk"}], ")"}], " ", 
              RowBox[{"hmean", "[", 
               RowBox[{
                RowBox[{"lambda", "[", 
                 RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                RowBox[{"lambda", "[", 
                 RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], "h"], 
            "]"}], " ", 
           RowBox[{
            SuperscriptBox["F", "\[Prime]",
             MultilineFunction->None], "[", "skbefore", "]"}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"pe", "-", "pk"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pe", "-", "pk"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "sebefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "pe"}], "+", "pk"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pe", "-", "pk"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "skbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"sebefore", ",", "lne"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}]}], ")"}]}]}], "+", 
      RowBox[{
       FractionBox["1", "h"], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"pk", "-", "pn"}], ")"}], " ", 
        RowBox[{"hmean", "[", 
         RowBox[{
          RowBox[{"lambda", "[", 
           RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
          RowBox[{"lambda", "[", 
           RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"HeavisideTheta", "[", 
            FractionBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{"pk", "-", "pn"}], ")"}], " ", 
              RowBox[{"hmean", "[", 
               RowBox[{
                RowBox[{"lambda", "[", 
                 RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                RowBox[{"lambda", "[", 
                 RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], "h"], 
            "]"}], " ", 
           RowBox[{
            SuperscriptBox["F", "\[Prime]",
             MultilineFunction->None], "[", "skbefore", "]"}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"pk", "-", "pn"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "pn"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "skbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "pk"}], "+", "pn"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "pn"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "snbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"snbefore", ",", "lnn"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}]}], ")"}]}]}], "+", 
      RowBox[{
       FractionBox["1", "h"], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"pk", "-", "ps"}], ")"}], " ", 
        RowBox[{"hmean", "[", 
         RowBox[{
          RowBox[{"lambda", "[", 
           RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
          RowBox[{"lambda", "[", 
           RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"HeavisideTheta", "[", 
            FractionBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "pk"}], "+", "ps"}], ")"}], " ", 
              RowBox[{"hmean", "[", 
               RowBox[{
                RowBox[{"lambda", "[", 
                 RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                RowBox[{"lambda", "[", 
                 RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], "h"], 
            "]"}], " ", 
           RowBox[{
            SuperscriptBox["F", "\[Prime]",
             MultilineFunction->None], "[", "skbefore", "]"}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "pk"}], "+", "ps"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "ps"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "skbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"pk", "-", "ps"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "ps"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "ssbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"ssbefore", ",", "lns"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}]}], ")"}]}]}], "+", 
      RowBox[{
       FractionBox["1", "h"], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"pk", "-", "pw"}], ")"}], " ", 
        RowBox[{"hmean", "[", 
         RowBox[{
          RowBox[{"lambda", "[", 
           RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
          RowBox[{"lambda", "[", 
           RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"HeavisideTheta", "[", 
            FractionBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "pk"}], "+", "pw"}], ")"}], " ", 
              RowBox[{"hmean", "[", 
               RowBox[{
                RowBox[{"lambda", "[", 
                 RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                RowBox[{"lambda", "[", 
                 RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}], "h"], 
            "]"}], " ", 
           RowBox[{
            SuperscriptBox["F", "\[Prime]",
             MultilineFunction->None], "[", "skbefore", "]"}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "pk"}], "+", "pw"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "pw"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "skbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}], "+", 
          RowBox[{
           FractionBox["1", "h"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"pk", "-", "pw"}], ")"}], " ", 
            RowBox[{"DiracDelta", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"(", 
                RowBox[{"pk", "-", "pw"}], ")"}], " ", 
               RowBox[{"hmean", "[", 
                RowBox[{
                 RowBox[{"lambda", "[", 
                  RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
                 RowBox[{"lambda", "[", 
                  RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}]}], "h"], 
             "]"}], " ", 
            RowBox[{"F", "[", "swbefore", "]"}], " ", 
            RowBox[{
             SuperscriptBox["hmean", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{
              RowBox[{"lambda", "[", 
               RowBox[{"skbefore", ",", "lnk"}], "]"}], ",", 
              RowBox[{"lambda", "[", 
               RowBox[{"swbefore", ",", "lnw"}], "]"}]}], "]"}], " ", 
            RowBox[{
             SuperscriptBox["lambda", 
              TagBox[
               RowBox[{"(", 
                RowBox[{"1", ",", "0"}], ")"}],
               Derivative],
              MultilineFunction->None], "[", 
             RowBox[{"skbefore", ",", "lnk"}], "]"}]}]}]}], ")"}]}]}]}], 
     ")"}]}]}]}]], "Output",
 CellChangeTimes->{3.7352871904273853`*^9, 3.735287519156646*^9, 
  3.7352876866697073`*^9},ExpressionUUID->"bb862f32-88a0-4b5c-bbed-\
70a7347ad0ac"]
}, Open  ]]
},
WindowSize->{808, 674},
WindowMargins->{{Automatic, 114}, {-86, Automatic}},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (April 18, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 641, 18, 32, "Input", "ExpressionUUID" -> \
"3c61f35a-b755-45f5-b649-45adc1aa30f5"],
Cell[CellGroupData[{
Cell[1224, 42, 282, 7, 32, "Input", "ExpressionUUID" -> \
"030cd932-4fb1-4400-99a9-4a5f9858f8c6"],
Cell[1509, 51, 663, 20, 55, "Output", "ExpressionUUID" -> \
"23a632f2-7605-41b2-85b2-a95311b3c85b"]
}, Open  ]],
Cell[2187, 74, 359, 10, 32, "Input", "ExpressionUUID" -> \
"a9ffe9a4-b898-46e0-8b69-be25933f186e"],
Cell[CellGroupData[{
Cell[2571, 88, 316, 9, 32, "Input", "ExpressionUUID" -> \
"085d25eb-7878-42af-9b6c-39151efe675f"],
Cell[2890, 99, 273, 9, 55, "Output", "ExpressionUUID" -> \
"2bebc656-e850-4002-bfea-16e5bf19fe3f"]
}, Open  ]],
Cell[3178, 111, 826, 21, 32, "Input", "ExpressionUUID" -> \
"78b3c9dd-837e-49d7-9034-51a0dc085d7a"],
Cell[4007, 134, 543, 14, 32, "Input", "ExpressionUUID" -> \
"9ef741a7-f0c8-40e0-81ea-d7d301fb57a2"],
Cell[4553, 150, 1152, 30, 75, "Input", "ExpressionUUID" -> \
"7b36a369-1dc9-4930-82a8-203f189d0b1c"],
Cell[CellGroupData[{
Cell[5730, 184, 506, 11, 54, "Input", "ExpressionUUID" -> \
"5313eccb-2a96-43ff-a55a-d47ee57f54a8"],
Cell[6239, 197, 985, 30, 32, "Output", "ExpressionUUID" -> \
"7206a949-0c6e-4a13-8a90-79941fd51940"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7261, 232, 370, 10, 32, "Input", "ExpressionUUID" -> \
"e7661b80-fe98-4504-ba02-280b81537db0"],
Cell[7634, 244, 511, 15, 53, "Output", "ExpressionUUID" -> \
"df0d8a42-edfa-4bf4-a521-7703f71af728"]
}, Open  ]],
Cell[8160, 262, 201, 4, 32, "Input", "ExpressionUUID" -> \
"569b7360-5313-4bce-8abd-a107075adfd8"],
Cell[CellGroupData[{
Cell[8386, 270, 319, 7, 32, "Input", "ExpressionUUID" -> \
"c0f42fc0-ba60-4828-b2d9-68407a26b221"],
Cell[8708, 279, 2279, 76, 100, "Output", "ExpressionUUID" -> \
"8356122b-e9e0-4a1d-8aca-36a730b56540"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11024, 360, 267, 6, 32, "Input", "ExpressionUUID" -> \
"e3ec01e8-cc2c-4e7e-b151-dfa58a69bf2b"],
Cell[11294, 368, 132, 3, 32, "Output", "ExpressionUUID" -> \
"b8c416b7-19c5-4391-a9eb-9da48156b03a"]
}, Open  ]],
Cell[11441, 374, 513, 14, 32, "Input", "ExpressionUUID" -> \
"5e066f53-a4d9-42f5-b5e7-510e74721938"],
Cell[11957, 390, 175, 3, 32, "Input", "ExpressionUUID" -> \
"44734e29-1c6d-4b7b-af80-d5bcdeb1e8ed"],
Cell[12135, 395, 1126, 26, 117, "Input", "ExpressionUUID" -> \
"1efb9c53-43db-4ac2-8c43-5bffdab9bb2b"],
Cell[13264, 423, 583, 15, 32, "Input", "ExpressionUUID" -> \
"19732302-0ac5-4fb8-84d6-14647ff9bf4d"],
Cell[13850, 440, 555, 16, 32, "Input", "ExpressionUUID" -> \
"e3fe45a6-dba8-461a-9213-cb075bcb78fa"],
Cell[14408, 458, 557, 16, 32, "Input", "ExpressionUUID" -> \
"41dec174-3c77-4a16-82f2-07b3b700cf02"],
Cell[14968, 476, 559, 16, 32, "Input", "ExpressionUUID" -> \
"62734858-5283-4908-99da-21fba927c924"],
Cell[15530, 494, 557, 16, 32, "Input", "ExpressionUUID" -> \
"012e5d3a-b7c1-43c9-aa60-4318f883c3cc"],
Cell[16090, 512, 1269, 29, 117, "Input", "ExpressionUUID" -> \
"19d88ea9-40b0-465c-ac9a-7a68bc5bfd2d"],
Cell[CellGroupData[{
Cell[17384, 545, 277, 7, 32, "Input", "ExpressionUUID" -> \
"95744756-87c2-4ca8-97a1-981b72d38e38"],
Cell[17664, 554, 22513, 598, 1586, "Output", "ExpressionUUID" -> \
"bb862f32-88a0-4b5c-bbed-70a7347ad0ac"]
}, Open  ]]
}
]
*)

